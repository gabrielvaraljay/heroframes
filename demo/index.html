<!DOCTYPE html>
<html>
<head>
  <title>HeroFrames Demo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: black; }
    .content { height: 100vh; background: #f0f0f0; display: flex; align-items: center; justify-content: center; }
    .loading { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; color: white; }
  </style>
</head>
<body>
  <div class="loading" id="loading">Loading frames...</div>
  <div id="hero-container"></div>
  <div class="content">
    <h1>Scroll up to see animation in reverse</h1>
  </div>
  
  <script>
    class HeroFrames {
      constructor(container, framesPath) {
        this.container = container;
        this.framesPath = framesPath;
        this.frames = [];
        this.canvas = null;
        this.ctx = null;
        this.frameIndex = 0;
        this.init();
      }

      async init() {
        this.createElements();
        await this.loadFrames();
        document.getElementById('loading').style.display = 'none';
        if (this.frames.length > 0) {
          this.setupAnimation();
        } else {
          this.showError();
        }
      }

      createElements() {
        this.container.style.position = 'relative';
        this.container.style.height = '300vh';
        
        this.canvas = document.createElement('canvas');
        this.canvas.style.position = 'fixed';
        this.canvas.style.top = '0';
        this.canvas.style.left = '0';
        this.canvas.style.width = '100vw';
        this.canvas.style.height = '100vh';
        this.canvas.style.zIndex = '-1';
        
        this.container.appendChild(this.canvas);
        this.ctx = this.canvas.getContext('2d');
      }

      async loadFrames() {
        for (let i = 100; i <= 250; i++) {
          try {
            const img = new Image();
            const frameNumber = i.toString().padStart(3, '0');
            const src = `${this.framesPath}/frame-${frameNumber}.webp`;
            
            await new Promise((resolve, reject) => {
              img.onload = resolve;
              img.onerror = reject;
              img.src = src;
            });
            
            this.frames.push(img);
          } catch (error) {
            console.warn(`Failed to load frame ${i}:`, error);
            break;
          }
        }
        
        console.log(`Loaded ${this.frames.length} frames (100-250)`);
      }

      showError() {
        this.container.innerHTML = `
          <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; z-index: 10;">
            <h2>No frames found</h2>
            <p>Place images in ./frames/ folder:</p>
            <p>frame-001.jpg, frame-002.jpg, etc.</p>
          </div>
        `;
      }

      drawFrame(frameIndex) {
        if (!this.canvas || !this.ctx || this.frames.length === 0) return;
        
        const frame = this.frames[Math.floor(frameIndex)];
        if (!frame) return;
        
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
        
        const scale = Math.max(
          this.canvas.width / frame.width,
          this.canvas.height / frame.height
        );
        
        const x = (this.canvas.width - frame.width * scale) / 2;
        const y = (this.canvas.height - frame.height * scale) / 2;
        
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.ctx.drawImage(frame, x, y, frame.width * scale, frame.height * scale);
      }

      setupAnimation() {
        this.drawFrame(0);

        gsap.timeline({
          scrollTrigger: {
            trigger: this.container,
            start: 'top top',
            end: 'bottom bottom',
            scrub: 1,
            onUpdate: (self) => {
              const frameIndex = self.progress * (this.frames.length - 1);
              this.frameIndex = frameIndex;
              this.drawFrame(frameIndex);
            }
          }
        });

        window.addEventListener('resize', () => this.drawFrame(this.frameIndex));
      }
    }

    gsap.registerPlugin(ScrollTrigger);
    new HeroFrames(document.getElementById('hero-container'), './frames');
  </script>
</body>
</html>